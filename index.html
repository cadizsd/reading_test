<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books API Example</title>
    <script>
        const server = 'http://YOUR-FLASK-SERVER-URL:8080';  // Replace with your actual server URL

        // Function to display the search results on the page
        function handleResponse(response) {
            var contentDiv = document.getElementById("content");
            contentDiv.innerHTML = "";  // Clear previous results

            if (response.items) {
                response.items.forEach(item => {
                    const book_id = item.id;
                    const title = item.volumeInfo.title;
                    const authors = item.volumeInfo.authors ? item.volumeInfo.authors.join(', ') : 'Unknown Author';
                    const pageCount = item.volumeInfo.pageCount || 0;
                    const isbn = item.volumeInfo.industryIdentifiers ? item.volumeInfo.industryIdentifiers[0].identifier : "N/A";
                    const description = item.volumeInfo.description || "No description available";

                    contentDiv.innerHTML += `<div class="book-result">
                        <h3>${title}</h3>
                        <p><strong>Author(s):</strong> ${authors}</p>
                        <p><strong>Page Count:</strong> ${pageCount}</p>
                        <p><strong>ISBN:</strong> ${isbn}</p>
                        <p><strong>Description:</strong> ${description}</p>
                        <button onclick="saveBook('${book_id}', '${title}', '${authors}', ${pageCount}, '${isbn}', '${description}')">Save to Bookshelf</button>
                    </div>`;
                });
            } else {
                contentDiv.innerHTML = "<p>No results found.</p>";
            }
        }

        // Function to fetch book search results from the Flask backend
        async function searchBooks() {
            const query = document.getElementById("query").value;
            try {
                const response = await fetch(`${server}/search?query=${query}`);
                const data = await response.json();
                handleResponse(data);
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while fetching results');
            }
        }

        // Function to save a selected book to DynamoDB
        async function saveBook(book_id, title, author, pageCount, isbn, description) {
            try {
                const response = await fetch(`${server}/save_book`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ book_id, title, author, page_count: pageCount, isbn, description })
                });
                const data = await response.json();
                alert(data.message || data.error);
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while saving the book');
            }
        }
    </script>
    <style>
        .book-result {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Books API Example</h1>
    <input type="text" id="query" placeholder="Enter book name" />
    <button onclick="searchBooks()">Search</button>
    <div id="content"></div>
</body>
</html>
